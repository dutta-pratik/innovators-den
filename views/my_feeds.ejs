<link rel="stylesheet" href="/css/index.css">

<div class="post-container">

    <% for(let i=0; i<posts.length; i++){ %>

        <% if(locals.user){ %>
            <% let isPost = 0; %> 
            <% if(!(locals.user._id.equals(posts[i].user._id))){ %>
                
                <% for(let k=0; k<pref.length; k++){ %>
                    <% for(let m=0; m<posts[0].interest.length; m++){ %>
                        
                        <% if(pref[k] == (posts[i].interest[m])){ %>
                            <% console.log("There") %> 
                            <% isPost++; %>
                            <%# console.log(isPost); %> 
                            <!-- shows only the post whose preference matches with the user interest -->
                            <div class="post">
    
                                <div>
                                    <textarea name="post-data" id="post-data" cols="55" rows="7" readonly style="resize: none; "><%= posts[i].post %> </textarea>
                                </div>
                            
                                <div id="post-btn">
                                    <div>
                                        <!-- likes -->
                                        <% if(posts[i].like.includes(loggedUser._id)){ %>
                                            <button id="like"><a href="/control/like/<%= posts[i]._id %>"><i class="fas fa-thumbs-up" style="color: rgb(114, 27, 27);"></i></a></button>
                                            <span id="no"><%= posts[i].like.length %> </span>
                                        <% }else{ %>
                                            <button id="like"><a href="/control/like/<%= posts[i]._id %>"><i class="fas fa-thumbs-up" style="color: grey;"></i></a></button>
                                            <span id="no"><%= posts[i].like.length %></span>
                                        <% } %> 
                                        
                                    </div>
                                    <div>
                                        <!-- dislike -->
                                        <% if(posts[i].dislike.includes(loggedUser._id)){ %>
                                            <button id="dislike"><a href="/control/dislike/<%= posts[i]._id %>"><i class="fas fa-thumbs-down" style="color: rgb(114, 27, 27);"></i></a></button>
                                            <span id="no"><%= posts[i].dislike.length %></span>
                                        <% }else{ %>
                                            <button id="dislike"><a href="/control/dislike/<%= posts[i]._id %>"><i class="fas fa-thumbs-down" style="color: gray;"></i></a></button>
                                            <span id="no"><%= posts[i].dislike.length %></span>
                                        <% } %> 
                                        
                                    </div>
                                    <div>
                                        <!-- go to  post -->
                                        <a href="/post/view/<%= posts[i]._id %>" id="goto"><i class="fas fa-arrow-right" style="font-size: larger;"></i></a>
                                    </div>
                                </div>
                                <div id="tag">
                                    <ul>
                                        <% for(let k=0; k<posts[i].interest.length; k++){ %>
                                            <li id="tag-list">
                                                <code> #<%= (posts[i].interest[k]) %> </code>
                                                
                                            </li>
                                        <% } %> 
                                    </ul>
                                        
                                </div>
            
                                <div id="post-author">
                                    <span>
                                        <%= posts[i].user.first_name %> 
                                    </span>
                                    <span><%= posts[i].user.second_name %></span>
                                </div>
                            
                            </div>


                        <% } %> 
                        
                    <% } %> 

                <% } %> 
    
            <% } %>
            <% if(isPost <= 0){ %>
                <%# console.log(isPost); %> 
                <h2>No Posts Available</h2>
            <% } %> 
        <% }%>

    <% } %> 

</div>

